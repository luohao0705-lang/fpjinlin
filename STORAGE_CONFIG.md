# 存储配置说明

## 📁 存储架构

### 1. **存储类型**
- **OSS存储**：阿里云对象存储（推荐）
- **本地存储**：服务器本地存储（备用）

### 2. **存储目录结构**
```
storage/
├── videos/          # 视频文件存储
│   ├── {videoFileId}/
│   │   ├── original.mp4      # 原始录制视频
│   │   ├── transcoded.mp4    # 转码后视频
│   │   └── segments/         # 视频切片
│   │       ├── segment_1.mp4
│   │       ├── segment_2.mp4
│   │       └── ...
├── segments/        # 切片文件存储
├── reports/         # 分析报告存储
└── temp/           # 临时文件存储
```

## ⚙️ 配置说明

### 1. **OSS配置（推荐）**
在后台"系统配置"中设置：
- **OSS存储桶名称**：`oss_bucket`
- **OSS访问域名**：`oss_endpoint`
- **OSS AccessKey**：`oss_access_key`
- **OSS SecretKey**：`oss_secret_key`

### 2. **本地存储配置**
- **存储路径**：`/www/wwwroot/hsh6.com/storage`
- **权限要求**：755（可读写）

## 🔄 存储策略

### 1. **优先级**
1. **OSS配置完整** → 上传到阿里云OSS
2. **OSS配置不完整** → 存储到本地
3. **上传失败** → 自动降级到本地存储

### 2. **文件标识**
- **OSS存储**：`videos/{videoFileId}/original.mp4`
- **本地存储**：`local://videos/{videoFileId}/original.mp4`

## 📊 存储管理

### 1. **存储状态页面**
- 访问：`/admin/storage_status.php`
- 功能：
  - 查看OSS配置状态
  - 检查本地存储权限
  - 统计文件数量
  - 测试存储功能

### 2. **存储测试**
- 自动测试上传、下载、删除功能
- 验证文件完整性
- 检查存储可用性

## 🛠️ 部署步骤

### 1. **创建存储目录**
```bash
mkdir -p /www/wwwroot/hsh6.com/storage/{videos,segments,reports,temp}
chmod 755 /www/wwwroot/hsh6.com/storage
chmod 755 /www/wwwroot/hsh6.com/storage/*
```

### 2. **配置OSS（可选）**
1. 登录阿里云控制台
2. 创建OSS存储桶
3. 获取AccessKey和SecretKey
4. 在后台系统配置中填入参数

### 3. **验证配置**
1. 访问存储状态页面
2. 运行存储测试
3. 检查所有功能正常

## 📝 注意事项

### 1. **文件清理**
- 临时文件自动清理
- 建议定期清理过期文件
- 监控存储空间使用情况

### 2. **权限管理**
- 确保Web服务器有存储目录写入权限
- 定期检查文件权限设置

### 3. **备份策略**
- OSS存储：自动多副本备份
- 本地存储：建议定期备份到其他位置

## 🔧 故障排除

### 1. **存储测试失败**
- 检查目录权限
- 验证OSS配置
- 查看错误日志

### 2. **文件上传失败**
- 检查网络连接
- 验证OSS配置
- 查看存储空间

### 3. **文件下载失败**
- 检查文件是否存在
- 验证访问权限
- 查看网络状态

## 📈 性能优化

### 1. **OSS优化**
- 使用CDN加速
- 启用压缩
- 设置缓存策略

### 2. **本地存储优化**
- 使用SSD存储
- 定期清理临时文件
- 监控磁盘空间

## 🚀 扩展功能

### 1. **多存储支持**
- 支持多个OSS存储桶
- 支持其他云存储服务
- 支持混合存储策略

### 2. **文件管理**
- 文件版本控制
- 文件生命周期管理
- 自动归档功能
